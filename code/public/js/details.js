!function(s){var d=new window.wangEditor("#editor");d.customConfig.menus=["bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","undo","redo"],d.customConfig.zIndex=2,d.customConfig.emotions=window.emotions||!1,d.create();var c=window.common;function r(){var t=a.data("captcha-url");a.find("img").attr("src",t+"?r="+Math.random())}s("#js_submit_comment").on("submit",function(t){var a=s(this).data("url"),e=s(this).data("id");t.preventDefault();var n=(d.txt.html()||"").trim();if(d.txt.text().trim().length<2)return c.toast("抬杠内容不能少于2个字"),!1;if(510<n.length)return c.toast("抬杠内容太多了，删减一点吧"),!1;var i={id:e,comment:n};if(0<s("#js_captcha_input").length){var o=(s("#js_captcha_input").val()||"").trim();if(!o)return c.toast("请输入验证码"),!1;i.captcha=o}c.loading("show"),s.ajax({url:a,type:"POST",dataType:"JSON",headers:{"Content-Type":"application/json"},data:JSON.stringify(i)}).done(function(t){"100"===t.code?(document.getElementById("js_submit_comment").reset(),d.txt.clear(),r(),c.toast("抬杠成功"),p(t.data,!0)):c.toast(t.desc)}).fail(function(t){0!==t.readyState&&c.toast("接口请求失败: "+(t.status||-1))}).always(function(){c.loading("hide")})});var a=s("#js_captcha").on("click",".js_captcha_change",r);function o(t){var a=["沙发","板凳","地板","地下室","下水道","地下城市","地核","地心","9重天"];return a[t]?a[t]:t+1+" #"}var l=s("#js_comment_list"),u=s("#js_total_comment").text()-0;function p(t,e){var n=l.children("li").length,i="";s.each(t,function(t,a){i+='<li class="item">',i+='  <div class="head">',i+='    <span class="glyphicon glyphicon-user" aria-hidden="true"></span>',i+="  </div>",i+=e?'  <address class="comment-address">来自 '+a.city+' 网友 <span class="floor">'+o(u)+"</span></address>":'  <address class="comment-address">来自 '+a.city+' 网友 <span class="floor">'+o(u-(n+t+1))+"</span></address>",i+='  <div class="comment-time">'+c.dateFormatBeforeN(a.createtime)+"</div>",i+='  <div class="comment-content">'+a.content+"</div>",i+='  <div class="like" data-id="'+a.id+'">',i+='    <a href="javascript:;" class="js_btn" data-type="1"><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>(<i>'+a.agree+"</i>)</a>",i+='    <a href="javascript:;" class="js_btn" data-type="0"><span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>(<i>'+a.oppose+"</i>)</a>",i+="  </div>",i+="</li>"}),e?(u+=t.length,s("#js_total_comment").text(u),l.prepend(i).removeClass("empty")):l.append(i)}var n=s("#js_get_more_comment"),i=n.data("total"),f=n.data("more-url");n.on("click",function(t){t.preventDefault();var a=this,e=s(a).data("page-no");c.loading("show"),s.ajax({url:f+e,type:"GET",dataType:"JSON"}).done(function(t){"100"===t.code?(s(a).data("page-no",e-0+1),i<e-0+1&&n.parent().addClass("off"),0<t.data.length?p(t.data):(c.toast("没有更多了"),n.parent().addClass("off"))):c.toast(t.desc)}).fail(function(t){0!==t.readyState&&c.toast("接口请求失败: "+(t.status||-1))}).always(function(){c.loading("hide")})});var m=s("#js_details_like");m.on("click",".js_btn",function(){var e=this,t=s(e).data("type"),a=m.data("url"),n=m.data("id");if(1===t||0===t){var i=s(e).data("code");if("100"!==i&&"200"!==i)c.loading("show"),s.ajax({url:a,type:"POST",dataType:"JSON",headers:{"Content-Type":"application/json"},data:JSON.stringify({id:n,data:t})}).done(function(t){if("100"===t.code||"200"===t.code){s(e).data("code",t.code);var a=s("i",e).text()-0+1;s("i",e).text(a)}else c.toast(t.desc)}).fail(function(t){0!==t.readyState&&c.toast("接口请求失败: "+(t.status||-1))}).always(function(){c.loading("hide")});else{var o=s("i",e).text()-0+1;s("i",e).text(o)}}}),l.on("click",".js_btn",function(){var e=this,t=s(e).data("type"),a=l.data("like-url"),n=s(e).parent().data("id");if(1===t||0===t){var i=s(e).data("code");if("100"!==i&&"200"!==i)c.loading("show"),s.ajax({url:a,type:"POST",dataType:"JSON",headers:{"Content-Type":"application/json"},data:JSON.stringify({id:n,data:t})}).done(function(t){if("100"===t.code||"200"===t.code){s(e).data("code",t.code);var a=s("i",e).text()-0+1;s("i",e).text(a)}else c.toast(t.desc)}).fail(function(t){0!==t.readyState&&c.toast("接口请求失败: "+(t.status||-1))}).always(function(){c.loading("hide")});else{var o=s("i",e).text()-0+1;s("i",e).text(o)}}})}(window.jQuery);